---
import IconSearch from '../components/icons/IconSearch.astro'
import { getCollection } from 'astro:content'
import ShortKey from '../components/ShortKey.astro'

const posts = (await getCollection('blog')).sort(
	(a, b) => a.data.pubDate.valueOf() - b.data.pubDate.valueOf()
)
---
<form
  id="searchForm"
  autocomplete="off"
  >
  <label for="searchInput"><span><IconSearch /></span></label>
  <input
    list="articles"
    type="search"
    name="search"
    id="searchInput"
    placeholder="Buscar artÃ­culo"
    tabindex="0"
    >
    <datalist id="articles">
      {posts.map((post) => {
        return <option value={post.data.title}></option>
      })}
    </datalist>
    <ShortKey key="k" command="Ctrl" />
</form>
<script>
  const searchForm = document.getElementById('searchForm')
  
  searchForm.addEventListener('submit', (event) => {
    event.preventDefault()
    const search = document.getElementById('searchInput').value.replace(/\s+/g, '-').toLowerCase()
    
    const isDevMode = "localhost/3000"
    const isProd = "http://blog.casvaru.com/blog/"

    const searchRedirect = `${isProd}? ${isProd}${search} : ${isDevMode} ${isDevMode}${search}`
    window.location.href = searchRedirect

    
  })
  // Short Key
  function ShortKey(event:any){
  if(event.key === 'k' && event.ctrlKey){
    event.preventDefault()
    document.getElementById('searchInput').focus()
  }
}
window.addEventListener('keydown', ShortKey)
</script>